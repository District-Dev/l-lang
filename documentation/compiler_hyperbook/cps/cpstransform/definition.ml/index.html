<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>cps/cpstransform/definition.ml</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0">
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/my.css" rel="stylesheet" media="screen">
    <link rel="alternate" type="application/rss+xml" title="L language - blog" href="/blog/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="L language - blog" href="/blog/atom.xml" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42249123-1', 'l-lang.org');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
     




   <div class="navbar navbar-inverse navbar-fixed-top navbar-default">
     <div class="container">
       <div class="navbar-header">
         <button
            type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#my-navbar">
           <span class="sr-only">Toggle navigation</span>
           
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="/"><i>The</i> L <i>language</i></a>
       </div>
       <div id="my-navbar" class="navbar-collapse collapse">
             <ul class="nav navbar-nav">
               

               
               
               

               
               <li class="dropdown">
                 <a href="/documentation/compiler_hyperbook" class="dropdown-toggle"
                    data-toggle="dropdown"> Documentation <b class="caret"></b> </a>
                 <ul class="dropdown-menu list-group">
                   <li class="dropdown-header">Introduction to L</li>
                   <li><a href="/documentation/intro/short">A tour of L (short intro)</a></li>
                   <li><a href="/documentation/intro/long">Descent into L (long intro)</a></li>
                   <li role="presentation" class="divider"></li>
                   <li class="dropdown-header">Inside the compiler</li>
                   <li><a href="/documentation/compiler_hyperbook/compilation_passes.ml">Compiler hyperbook</a></li>
                 </ul>
               </li>

               

               <li class="dropdown">
                 <a href="/blog" class="dropdown-toggle"
                    data-toggle="dropdown"> Blog <b class="caret"></b> </a>
                 <ul class="dropdown-menu">
                   <li class="dropdown-header">Recent posts</li>
                   
                   <li><a href="/blog/TDOP---Pratt-parser-in-pictures">TDOP / Pratt parser in pictures</a></li>
                   
                   <li><a href="/blog/Structuring-the-compiler">Structuring the compiler</a></li>
                   
                   <li><a href="/blog/Compiling-pattern-matching">Compiling pattern matching</a></li>
                   
                   <li><a href="/blog/A-framework-for-CPS-transformation-and-a-Github-account">A framework for CPS transformation (and a Github account)</a></li>
                   
                   <li><a href="/blog/Using-OCaml-packages-with-ocamlbuild-a-recipe">Using OCaml packages with ocamlbuild: a recipe</a></li>
                   
                   <li><a href="/blog/A-literate-union-find-data-structure">A literate union-find data structure</a></li>
                   
                   <li><a href="/blog/CPS-to-LLVM-SSA-conversion-in-literate-programming">CPS to LLVM SSA conversion in literate programming</a></li>
                   
                   <li><a href="/blog/Incorporating-C-code-in-an-Ocaml-project-using-Ocamlbuild">Incorporating C code in an Ocaml project using Ocamlbuild</a></li>
                   
                   <li><a href="/blog/A-typecast-with-many-uses">A typecast with many uses</a></li>
                   
                   <li><a href="/blog/Guaranteed-optimizations-for-system-programming-languages">Guaranteed optimizations for system programming languages</a></li>
                   
                   <li class="divider"></li>
                   <li><a href="/blog">More blog entries...</a></li>
                 </ul>
               </li>

               <li><a href="https://github.com/mlemerre/l-lang">GitHub</a></li>

             </ul>

             
           </div><!--/.nav-collapse -->
         </div>
       </div>

     <div class="container">
     <div class="row">
  <div class="col-md-3">
    <ul class="nav nav-list">
      <li class="nav-header">
        <a href="/documentation/compiler_hyperbook">Compiler HyperBook</a></li>
      <div class="css-treeview" >
       <ul>
   <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/compilation_passes" /><label for="/documentation/compiler_hyperbook/compilation_passes">&#x2013;</label> <a href="/documentation/compiler_hyperbook/compilation_passes.ml">compilation_passes.ml</a> </li>
   <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/cps" /><label for="/documentation/compiler_hyperbook/cps">&#x25B7;</label> cps
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpsbase" /><label for="/documentation/compiler_hyperbook/cps/cpsbase">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase.mli">cpsbase.mli</a>
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsast" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsast">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsast.ml">cpsast.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck.ml">cpscheck.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.mli">cpsdef.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.ml">cpsdef.ml</a></li></ul> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint.ml">cpsprint.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.mli">cpsvar.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.ml">cpsvar.ml</a></li></ul> </li>
         </ul>
       </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsconvertclosures" /><label for="/documentation/compiler_hyperbook/cps/cpsconvertclosures">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsconvertclosures.ml">cpsconvertclosures.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsfree" /><label for="/documentation/compiler_hyperbook/cps/cpsfree">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsfree.ml">cpsfree.ml</a> </li>
       <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpstransform" /><label for="/documentation/compiler_hyperbook/cps/cpstransform">&#x25B7;</label> cpstransform
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/base" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/base">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/base.ml">base.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/definition" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/definition.ml">definition.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/expression" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/expression.ml">expression.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/rules" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/rules">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/rules.ml">rules.ml</a> </li>
         </ul>
       </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/llvm" /><label for="/documentation/compiler_hyperbook/llvm">&#x25B7;</label> llvm
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/llvm" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.mli">cpsllvm.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x2013;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.ml">cpsllvm.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/parser" /><label for="/documentation/compiler_hyperbook/parser">&#x25B7;</label> parser
     <ul>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/common" /><label for="/documentation/compiler_hyperbook/parser/common">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/common.ml">common.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/definition" /><label for="/documentation/compiler_hyperbook/parser/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/definition.ml">definition.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/expression" /><label for="/documentation/compiler_hyperbook/parser/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/expression.ml">expression.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/path" /><label for="/documentation/compiler_hyperbook/parser/path">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/path.ml">path.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/parser" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.mli">tdop.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.ml">tdop.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/support" /><label for="/documentation/compiler_hyperbook/support">&#x25B7;</label> support
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/union_find.mli">union_find.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/union_find.ml">union_find.ml</a></li></ul> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/unique.mli">unique.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/unique.ml">unique.ml</a></li></ul> </li>
     </ul>
   </li>
 </ul>

      </div>
    </ul>
  </div>
  <div class="col-md-9">
    <div class="post-title">
      <h1>cps/cpstransform/definition.ml</h1>
    </div>
    
<!--CUT STYLE article--><!--CUT DEF section 1 --><!--TOC section id="sec1" Module Definition-->
<h2 id="sec1" class="section">Module Definition</h2><!--SEC END --><p>
This module performs CPS transformation of definitions; it is
similar to the transformation proposed in "Compiling with
continuations, continued" by A. Kennedy.</p><p>CPS transformation names all intermediary results, and fixes the
order of evaluation; so it is in this module that we define that
arguments to functions are evaluated from left to right, that a
function is evaluated before its arguments, how pattern matching is
compiled...</p><p><BR><a id="src/cps/cpstransform/definition.ml:505"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Build</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Cpsbase.Build</span></p><p><a id="src/cps/cpstransform/definition.ml:536"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Ast</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Ast.Def</span></p><p><a id="src/cps/cpstransform/definition.ml:559"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">AstVarMap</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Ast.Variable.Map</span></p><p><a id="src/cps/cpstransform/definition.ml:598"></a>
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;expression&nbsp;=&nbsp;<span style="color: #228b22; ">Expression.Expression.</span>transform</p><p></code></div>
Transform an expression (typically the expr in Ast.Def(x,expr) or
Ast.Nodef(expr)) to a CPS definition 
<BR>
Transform a definition. Returns a list of cps definitions, and the
new environment. 
<BR><a id="src/cps/cpstransform/definition.ml:856"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;transform&nbsp;env&nbsp;def&nbsp;=<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;halt_ctx&nbsp;=&nbsp;(<span style="color: #a020f0; ">fun</span>&nbsp;x&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">Build.</span>halt&nbsp;x)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;def&nbsp;<span style="color: #a020f0; ">with</span></p><p></code></div>&nbsp;&nbsp;
Definitions whose result is not used. 
<BR><a id="src/cps/cpstransform/definition.ml:988"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Expression</span>(exp)&nbsp;<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Value</span>([<span style="color: #228b22; ">Ast.Pattern.Wildcard</span>,&nbsp;exp])&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
[<span style="color: #228b22; ">Cpsbase.Definition</span>(&nbsp;<span style="color: #228b22; ">Cpsbase.Unused</span>,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Cpsbase.Dynamic_value</span>&nbsp;(expression&nbsp;exp&nbsp;env&nbsp;halt_ctx))],<BR>&nbsp;&nbsp;&nbsp;&nbsp;
env</p><p></code></div>&nbsp;&nbsp;
Non-recursive definitions. 
<BR><a id="src/cps/cpstransform/definition.ml:1246"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Value</span>([<span style="color: #228b22; ">Ast.Pattern.Variable</span>&nbsp;var,exp])&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;e&nbsp;=&nbsp;expression&nbsp;exp&nbsp;env&nbsp;halt_ctx&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;definition&nbsp;=&nbsp;<span style="color: #228b22; ">Build.</span>with_var_in_def&nbsp;(<span style="color: #a020f0; ">fun</span>&nbsp;v&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Cpsbase.Definition</span>(<span style="color: #228b22; ">Cpsbase.Public</span>&nbsp;v,&nbsp;<span style="color: #228b22; ">Cpsbase.Dynamic_value</span>&nbsp;e))&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #228b22; ">Cpsbase.Definition</span>(<span style="color: #228b22; ">Cpsbase.Public</span>&nbsp;v,_)&nbsp;=&nbsp;definition&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
([definition],&nbsp;<span style="color: #228b22; ">AstVarMap.</span>add&nbsp;var&nbsp;(<span style="color: #228b22; ">Cpsbase.Var.Occur.</span>maker&nbsp;v)&nbsp;env)</p><p><a id="src/cps/cpstransform/definition.ml:1608"></a>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Value</span>(_)&nbsp;&#X2192;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">failwith</span>&nbsp;<span style="color: #8b2252; ">"Definitions&nbsp;with&nbsp;general&nbsp;patterns&nbsp;are&nbsp;not&nbsp;yet&nbsp;supported"</span></p><p></code></div>&nbsp;&nbsp;
Definitions are not directly recursive; i.e. <code>def&nbsp;id&nbsp;=&nbsp;...id...</code>
is transformed into <code>def&nbsp;id&nbsp;=&nbsp;{<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;id&nbsp;=&nbsp;...&nbsp;id&nbsp;...;&nbsp;id}</code>. This is
because LLVM output is (currently) not able to deal with
recursive definitions with dynamic values, because of the
additional indirection. 
<BR><a id="src/cps/cpstransform/definition.ml:2010"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Value_rec</span>([var,exp])&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;def&nbsp;=&nbsp;<span style="color: #228b22; ">Build.</span>with_var_in_def&nbsp;(<span style="color: #a020f0; ">fun</span>&nbsp;defv&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;e&nbsp;=&nbsp;<span style="color: #228b22; ">Build.</span>with_var_in_expression&nbsp;(<span style="color: #a020f0; ">fun</span>&nbsp;v&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;rec_v&nbsp;=&nbsp;<span style="color: #228b22; ">Cpsbase.Var.Occur.</span>rec_maker&nbsp;v&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;rec_map&nbsp;=&nbsp;<span style="color: #228b22; ">AstVarMap.</span>add&nbsp;var&nbsp;rec_v&nbsp;env&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
expression&nbsp;~v&nbsp;exp&nbsp;rec_map&nbsp;(<span style="color: #a020f0; ">fun</span>&nbsp;v&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
halt_ctx&nbsp;v))&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Cpsbase.Definition</span>(<span style="color: #228b22; ">Cpsbase.Public</span>&nbsp;defv,&nbsp;<span style="color: #228b22; ">Cpsbase.Dynamic_value</span>&nbsp;e))&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #228b22; ">Cpsbase.Definition</span>(<span style="color: #228b22; ">Cpsbase.Public</span>&nbsp;defv,_)&nbsp;=&nbsp;def&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
([def],&nbsp;<span style="color: #228b22; ">AstVarMap.</span>add&nbsp;var&nbsp;(<span style="color: #228b22; ">Cpsbase.Var.Occur.</span>maker&nbsp;defv)&nbsp;env)</p><p><a id="src/cps/cpstransform/definition.ml:2536"></a>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Ast.Definition.Type_name</span>&nbsp;(_,_,_)&nbsp;&#X2192;&nbsp;([&nbsp;],env)</p><p></code></div>
TODO:</p><p>- We can extend <code><span style="color: #228b22; ">Halt</span></code> to handle several variables, with a
construct like <code><span style="color: #228b22; ">Halt</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;def_vars&nbsp;×&nbsp;expr_vars</code>. This would be useful
for both <code><span style="color: #228b22; ">Value_rec</span></code> with several variables, and for more general
patterns (that can bind several variables at once).</p><p>- (Maybe). We could have a <code>value</code> function to build values, and
only those would have the &nbsp;v argument (or a list of &nbsp;v). </p><p>- Allow mutual recursions, mainly for functions but also for
objects, perhaps through forward declarations. This is related to
making the allocations explicit, and to typing (to know the size of
the allocations). A forward declaration corresponds to allocation
of object, which can be separated from its initialization.</p><p>- Link each CPS variable to its corresponding subterm. This would
allow to display proper error messages if there is an error after
the CPS transformation, and could help put debugging information
in the compiler. In addition, when the ADT is typed, type
information should be transformed to CPS.</p><p><BR></p><!--CUT END -->



    <hr />
  </div>
</div>
 
     </div>
          

   
   <script src="/js/jquery.js"></script>
   

   <script src="/dist/js/bootstrap.min.js"></script>

   

   
   <script type="text/javascript">
   $('.my-email').html(function(){
	var d = "t@l-la";
	var e = "ma";
	var a = "t";
	var c = "ng.org";
	var h = 'mailto:' + e + a + d + c;
	$(this).parent('a').attr('href', h);
	return e + a + d + c;
   });
   </script>

  </body>
</html>
