<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>cps/cpsbase/cpsast.ml</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0">
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/my.css" rel="stylesheet" media="screen">
    <link rel="alternate" type="application/rss+xml" title="L language - blog" href="/blog/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="L language - blog" href="/blog/atom.xml" />
  </head>

  <body>
     




   <div class="navbar navbar-inverse navbar-fixed-top navbar-default">
     <div class="container">
       <div class="navbar-header">
         <button
            type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#my-navbar">
           <span class="sr-only">Toggle navigation</span>
           
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="/"><i>The</i> L <i>language</i></a>
       </div>
       <div id="my-navbar" class="navbar-collapse collapse">
             <ul class="nav navbar-nav">
               

               
               
               

               
               <li class="dropdown">
                 <a href="/documentation/compiler_hyperbook" class="dropdown-toggle"
                    data-toggle="dropdown"> Documentation <b class="caret"></b> </a>
                 <ul class="dropdown-menu list-group">
                   <li class="dropdown-header">Introduction to L</li>
                   <li><a href="/documentation/intro/short">A tour of L (short intro)</a></li>
                   <li><a href="/documentation/intro/long">Descent into L (long intro)</a></li>
                   <li role="presentation" class="divider"></li>
                   <li class="dropdown-header">Inside the compiler</li>
                   <li><a href="/documentation/compiler_hyperbook/compilation_passes.ml">Compiler hyperbook</a></li>
                 </ul>
               </li>

               

               <li class="dropdown">
                 <a href="/blog" class="dropdown-toggle"
                    data-toggle="dropdown"> Blog <b class="caret"></b> </a>
                 <ul class="dropdown-menu">
                   <li class="dropdown-header">Recent posts</li>
                   
                   <li><a href="/blog/TDOP---Pratt-parser-in-pictures">TDOP / Pratt parser in pictures</a></li>
                   
                   <li><a href="/blog/Structuring-the-compiler">Structuring the compiler</a></li>
                   
                   <li><a href="/blog/Compiling-pattern-matching">Compiling pattern matching</a></li>
                   
                   <li><a href="/blog/A-framework-for-CPS-transformation-and-a-Github-account">A framework for CPS transformation (and a Github account)</a></li>
                   
                   <li><a href="/blog/Using-OCaml-packages-with-ocamlbuild-a-recipe">Using OCaml packages with ocamlbuild: a recipe</a></li>
                   
                   <li><a href="/blog/A-literate-union-find-data-structure">A literate union-find data structure</a></li>
                   
                   <li><a href="/blog/CPS-to-LLVM-SSA-conversion-in-literate-programming">CPS to LLVM SSA conversion in literate programming</a></li>
                   
                   <li><a href="/blog/Incorporating-C-code-in-an-Ocaml-project-using-Ocamlbuild">Incorporating C code in an Ocaml project using Ocamlbuild</a></li>
                   
                   <li><a href="/blog/A-typecast-with-many-uses">A typecast with many uses</a></li>
                   
                   <li><a href="/blog/Guaranteed-optimizations-for-system-programming-languages">Guaranteed optimizations for system programming languages</a></li>
                   
                   <li class="divider"></li>
                   <li><a href="/blog">More blog entries...</a></li>
                 </ul>
               </li>

               <li><a href="https://github.com/mlemerre/l-lang">GitHub</a></li>

             </ul>

             
           </div><!--/.nav-collapse -->
         </div>
       </div>

     <div class="container">
     <div class="row">
  <div class="col-md-3">
    <ul class="nav nav-list">
      <li class="nav-header">
        <a href="/documentation/compiler_hyperbook">Compiler HyperBook</a></li>
      <div class="css-treeview" >
       <ul>
   <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/compilation_passes" /><label for="/documentation/compiler_hyperbook/compilation_passes">&#x2013;</label> <a href="/documentation/compiler_hyperbook/compilation_passes.ml">compilation_passes.ml</a> </li>
   <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/cps" /><label for="/documentation/compiler_hyperbook/cps">&#x25B7;</label> cps
     <ul>
       <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpsbase" /><label for="/documentation/compiler_hyperbook/cps/cpsbase">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase.mli">cpsbase.mli</a>
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsast" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsast">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsast.ml">cpsast.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck.ml">cpscheck.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.mli">cpsdef.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.ml">cpsdef.ml</a></li></ul> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint.ml">cpsprint.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.mli">cpsvar.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.ml">cpsvar.ml</a></li></ul> </li>
         </ul>
       </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsconvertclosures" /><label for="/documentation/compiler_hyperbook/cps/cpsconvertclosures">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsconvertclosures.ml">cpsconvertclosures.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsfree" /><label for="/documentation/compiler_hyperbook/cps/cpsfree">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsfree.ml">cpsfree.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpstransform" /><label for="/documentation/compiler_hyperbook/cps/cpstransform">&#x25B7;</label> cpstransform
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/base" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/base">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/base.ml">base.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/definition" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/definition.ml">definition.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/expression" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/expression.ml">expression.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/rules" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/rules">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/rules.ml">rules.ml</a> </li>
         </ul>
       </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/llvm" /><label for="/documentation/compiler_hyperbook/llvm">&#x25B7;</label> llvm
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/llvm" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.mli">cpsllvm.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x2013;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.ml">cpsllvm.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/parser" /><label for="/documentation/compiler_hyperbook/parser">&#x25B7;</label> parser
     <ul>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/common" /><label for="/documentation/compiler_hyperbook/parser/common">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/common.ml">common.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/definition" /><label for="/documentation/compiler_hyperbook/parser/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/definition.ml">definition.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/expression" /><label for="/documentation/compiler_hyperbook/parser/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/expression.ml">expression.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/path" /><label for="/documentation/compiler_hyperbook/parser/path">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/path.ml">path.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/parser" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.mli">tdop.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.ml">tdop.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/support" /><label for="/documentation/compiler_hyperbook/support">&#x25B7;</label> support
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/union_find.mli">union_find.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/union_find.ml">union_find.ml</a></li></ul> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/unique.mli">unique.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/unique.ml">unique.ml</a></li></ul> </li>
     </ul>
   </li>
 </ul>

      </div>
    </ul>
  </div>
  <div class="col-md-9">
    <div class="post-title">
      <h1>cps/cpsbase/cpsast.ml</h1>
    </div>
    
<!--CUT STYLE article--><!--CUT DEF section 1 --><!--TOC section id="sec1" Module Cpsast-->
<h2 id="sec1" class="section">Module Cpsast</h2><!--SEC END --><p>
<span style="font-weight:bold">1.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:42"></a>This file presents the terms, i.e. the abstract syntax, of the CPS
intermediate language. These definitions originates from the
"compiling with continuations, continued" paper, by Andrew Kennedy.</p><p>CPS (for continuation passing style) puts constraints on functional
programs so that a function <span style="font-style:italic">f</span> never returns; instead it is passed
a continuation <span style="font-style:italic">k</span>, which is a function that represents what is
executed on <span style="font-style:italic">f</span> has finished its execution. So instead of returning
a value <span style="font-style:italic">x</span>, <span style="font-style:italic">f</span> "returns" by calling <span style="font-style:italic">k</span>(<span style="font-style:italic">x</span>). CPS style makes
returning from functions, and more generally control flow, explicit,
at the expense of more verbosity (amounting to naming all
intermediary results).</p><p>This file presents a particular representation of CPS expressions
that separates continuations, calling a continuations, variables
holding continations from (respectively) normal functions, normal
function calls, and normal variables. This distinction allows to
compile the CPS program using a stack (see the <code><span style="color: #228b22; ">Cpsllvm</span></code> module for
an implementation of that).</p><p>The representation also forces all values (including constants such
as integers) to be held in variables, which simplify later
transformation algorithms. 
<BR><a id="src/cps/cpsbase/cpsast.ml:1277"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;<span style="color: #228b22; ">S</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">sig</span><BR></code></div><span style="font-weight:bold">2.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:1303"></a>The representation use separate types for variables (to use
where the variable is bound) from occurrence of a variable (to use
where a variable is used). Variables and occurrences are globally
unique, which avoids any need for alpha conversion. 
<BR><a id="src/cps/cpsbase/cpsast.ml:1565"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;var<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;occur<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;cont_var<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;cont_occur<BR></code></div><span style="font-weight:bold">3.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:1628"></a>We distinguish the type <code>expression_</code>, that holds the sum type
representing the various expressions, and the type <code>expression</code>, that also
holds other information (such as the uplink to the enclosing
expression).</p><p>The representation of CPS expressions separates continuations from
usual functions. The various expressions are:</p><ul class="itemize"><li class="li-itemize">
<span style="font-weight:bold"><span style="font-style:italic">let</span></span> <span style="font-style:italic">x</span> = <span style="font-style:italic">primitive</span>; <span style="font-style:italic">body</span> creates a binding to a primitive
value, or to the result of a primitive operation (to be used in
body)</li><li class="li-itemize"><span style="font-weight:bold"><span style="font-style:italic">let</span></span> <span style="font-style:italic">k</span>(<span style="font-style:italic">x</span>) = <span style="font-style:italic">t</span>; <span style="font-style:italic">body</span>  creates a binding to a
continuation <span style="font-style:italic">k</span>. <span style="font-style:italic">x</span> is bound in <span style="font-style:italic">t</span>, but not in <span style="font-style:italic">body</span>. The <span style="font-style:italic">k</span>
continuation variable is bound both in <span style="font-style:italic">body</span> and <span style="font-style:italic">t</span> (this allows
loops).</li><li class="li-itemize"><span style="font-style:italic">k</span>(<span style="font-style:italic">x</span>) calls the <em>continuation</em> <span style="font-style:italic">k</span> with <span style="font-style:italic">x</span>. It can be
seen as a "jump with argument <span style="font-style:italic">x</span>"</li><li class="li-itemize"><span style="font-style:italic">v</span>(<span style="font-style:italic">k</span>,<span style="font-style:italic">xl</span>) calls the <em>function</em> <span style="font-style:italic">v</span>, <span style="font-style:italic">k</span> being the
return continuation, and <span style="font-style:italic">xl</span> a list of parameters. <span style="font-style:italic">v</span> does not
return; instead it will call <span style="font-style:italic">k</span> with the "return values" as
parameters.</li><li class="li-itemize"><span style="font-weight:bold"><span style="font-style:italic">case</span></span>(<span style="font-style:italic">x</span>){ i_1 &#X2192;k_1 &#X2026;<span style="font-style:italic">i</span><sub><span style="font-style:italic">n</span></sub> &#X2192; <span style="font-style:italic">k</span><sub><span style="font-style:italic">n</span></sub> <sub>&#X2192;</sub><span style="font-style:italic">kdefault</span> } extracts the tag <span style="font-style:italic">i</span> and value <span style="font-style:italic">v</span> from <span style="font-style:italic">x</span>; then
compares <span style="font-style:italic">i</span> to all the <span style="font-style:italic">i</span><sub>1</sub> &#X2026; <span style="font-style:italic">i</span><sub><span style="font-style:italic">n</span></sub>, and if equal calls the
corresponding continuation <span style="font-style:italic">k</span> with argument <span style="font-style:italic">v</span>. If no suitable
<span style="font-style:italic">i</span> is found, a default must have been provided, and <span style="font-style:italic">kdefault</span> is
called with argument <span style="font-style:italic">x</span>.
Note: <code><span style="color: #228b22; ">Apply_cont</span></code> can be seen as a special case of <code><span style="color: #228b22; ">Case</span></code> with a
default argument and no pattern rule; and could be removed.</li><li class="li-itemize"><span style="font-style:italic">halt</span>(<span style="font-style:italic">x</span>) is used only as a base case, to stop induction. Its
semantics is that it returns the value <code>x</code>, which is the result of
the computation, to the caller.
</li></ul><p> 
<BR><a id="src/cps/cpsbase/cpsast.ml:3400"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;expression</p><p><a id="src/cps/cpsbase/cpsast.ml:3420"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;expression_&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Let_prim</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;var&nbsp;×&nbsp;primitive&nbsp;×&nbsp;expression<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Let_cont</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;cont_var&nbsp;×&nbsp;var&nbsp;×&nbsp;expression&nbsp;×&nbsp;expression<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Apply_cont</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;cont_occur&nbsp;×&nbsp;occur<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Apply</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;function_type&nbsp;×&nbsp;occur&nbsp;×&nbsp;cont_occur&nbsp;×&nbsp;occur&nbsp;<span style="color: #228b22; ">list</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Case</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;occur&nbsp;×&nbsp;cont_occur&nbsp;case_map&nbsp;×&nbsp;cont_occur&nbsp;<span style="color: #228b22; ">option</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Halt</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;occur</p><p></code></div>&nbsp;&nbsp;
A structure mapping cases (represented by an int) to something
representing the body corresponding to the case. 
<BR><a id="src/cps/cpsbase/cpsast.ml:3846"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;&#X3B1;&nbsp;case_map</p><p></code></div>&nbsp;&nbsp;
Primitive are values, or operations that return a value. The
various operations do not take values as parameters (even
constants such as int), only variables: the representation forces
all values to be bound in a variable. This allows a uniform
treatment that helps transformation passes.</p><p>The various operations are:</p><ul class="itemize"><li class="li-itemize"><span style="font-style:italic">x</span>[<span style="font-style:italic">i</span>] get the <span style="font-style:italic">i</span>th element out of <span style="font-style:italic">x</span>. <span style="font-style:italic">x</span> is a variable
bound to a tuple.</li><li class="li-itemize"><span style="font-style:italic">x</span><sub>1</sub> <span style="font-style:italic">op</span> <span style="font-style:italic">x</span><sub>2</sub> applies a binary operation to two arguments.</li><li class="li-itemize"><span style="font-style:italic">x</span><sub><span style="font-style:italic">i</span></sub> <span style="font-style:italic">pred</span> <span style="font-style:italic">x</span><sub>2</sub> applies a binary predicate to two arguments.</li></ul><p>Note that there are no primitive that would allow to write <span style="font-weight:bold"><span style="font-style:italic">let</span></span> <span style="font-style:italic">x</span> = <span style="font-style:italic">y</span>, where <span style="font-style:italic">y</span> is a variable; thus there cannot be two
variables that directly share the same value. 
<BR><a id="src/cps/cpsbase/cpsast.ml:4684"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;primitive&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Value</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;value<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Projection</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">int</span>&nbsp;×&nbsp;occur<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Integer_binary_operation</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">Constant.Ibop.</span>t&nbsp;×&nbsp;occur&nbsp;×&nbsp;occur<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Integer_binary_predicate</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">Constant.Ibpred.</span>t&nbsp;×&nbsp;occur&nbsp;×&nbsp;occur</p><p></code></div>&nbsp;&nbsp;
Values are completely evaluated objects. They are separated from
primitives only because they can be evaluated statically and put
in a read-only data section.</p><ul class="itemize"><li class="li-itemize"><code><span style="color: #228b22; ">Constant</span></code> is self-explinatory;</li><li class="li-itemize"><span style="font-style:italic">t</span> = (<span style="font-style:italic">x</span><sub>0</sub>,...,<span style="font-style:italic">x</span><sub><span style="font-style:italic">n</span>&#X2212;1</sub>) corresponds to a contiguous zone of
memory; each field <span style="font-style:italic">i</span> is accessible using <span style="font-style:italic">t</span>[<span style="font-style:italic">i</span>] (<code><span style="color: #228b22; ">Proj</span></code>). The
reason why we prefer <code><span style="color: #228b22; ">Tuple</span></code> over using chains of <code><span style="color: #228b22; ">Pair</span></code>, is
<code><span style="color: #228b22; ">Pair</span></code> cannot be compiled to a contiguous zone of memory (without
indirection), without prior transformation to <code><span style="color: #228b22; ">Tuple</span></code>.</li><li class="li-itemize"><span style="font-style:italic">inj</span><sub><span style="font-style:italic">i</span>/<span style="font-style:italic">j</span></sub>(<span style="font-style:italic">x</span>) creates a variant value, with tag number <span style="font-style:italic">i</span>
(starting from 0) over <span style="font-style:italic">j</span> possible tags.</li><li class="li-itemize">{ <span style="font-style:italic">k</span> &#X2192; (<span style="font-style:italic">x</span><sub>0</sub>,...,<span style="font-style:italic">x</span><sub><span style="font-style:italic">n</span>&#X2212;1</sub>) &#X2192; <span style="font-style:italic">body</span>} build a function.
Functions can have several arguments, because this simplifies
closure conversion, and allows to express some transformations
such as arity-raising.</li><li class="li-itemize"><code><span style="color: #a020f0; ">external</span>(&nbsp;name)</code> denotes a value defined in another
compilation unit.</li></ul><p>
Note that contrary to the source language, we can have Tuple
objets with 1 element; they correspond to pointers to an object.
<code>x</code> is different from <code><span style="color: #228b22; ">Tuple</span>(&nbsp;[x])</code>. 
<BR><a id="src/cps/cpsbase/cpsast.ml:6101"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;value&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Constant</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">Constant.</span>t<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Tuple</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;occur&nbsp;<span style="color: #228b22; ">list</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Injection</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">int</span>&nbsp;×&nbsp;<span style="color: #228b22; ">int</span>&nbsp;×&nbsp;occur<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Lambda</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;function_type&nbsp;×&nbsp;cont_var&nbsp;×&nbsp;var&nbsp;<span style="color: #228b22; ">list</span>&nbsp;×&nbsp;expression<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">External</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;<span style="color: #228b22; ">string</span></p><p></code></div>&nbsp;&nbsp;
We distinguish closures, that may contain free variables which
constitutes an environment that need to be stored, from
functions, who may not. We distinguish them only as an argument
to <code><span style="color: #228b22; ">Apply</span></code> and <code><span style="color: #228b22; ">Lambda</span></code>, because most of the code that access
them does not depend on this distinction. Having functions at
the top level is useful, for instance, to interact with C. 
<BR><a id="src/cps/cpsbase/cpsast.ml:6690"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;function_type&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Closure</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">No_environment</span><BR></code></div><span style="font-weight:bold">4.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:6749"></a>We now present the logical structure of toplevel definitions. A
definition is like a let-binding, except that the variable is
bound globally (and are thus accessible to all the following
definitions), instead of just in the body the let-binding. 
<BR><a id="src/cps/cpsbase/cpsast.ml:7012"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;definitions&nbsp;=&nbsp;definition&nbsp;<span style="color: #228b22; ">list</span><BR></code></div><span style="font-weight:bold">5.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:7054"></a>A <code>definition</code> binds a (global) variable to a value, with some
<code>visibility</code>. <code><span style="color: #228b22; ">Public</span></code> global variables may be used by other
modules. <code><span style="color: #228b22; ">Private</span></code> ones can be used by other definitions of the
module. <code><span style="color: #228b22; ">Unused</span></code> ones cannot be used by any code, they are used to
represent computations used only for their side effects.</p><p>Note that <code><span style="color: #228b22; ">Unused</span></code> cannot be replaced by a check that the variable
has no occurrences when compiling incrementally: indeed when the
definition is compiled, the variable may not yet have any
occurrence. 
<BR><a id="src/cps/cpsbase/cpsast.ml:7606"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;definition&nbsp;=&nbsp;<span style="color: #228b22; ">Definition</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;visibility&nbsp;×&nbsp;definition_type<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;visibility&nbsp;=&nbsp;<span style="color: #228b22; ">Public</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;var&nbsp;&#X2223;&nbsp;<span style="color: #228b22; ">Private</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;var&nbsp;&#X2223;&nbsp;<span style="color: #228b22; ">Unused</span></p><p></code></div>&nbsp;&nbsp;
Variables can be bound either to statically computed and
allocated values and functions (put in .data/.rodata/.text
sections), or dynamic values, computed at initialization time and
compiled into constructors calls (.ctors and .bss). 
<BR><a id="src/cps/cpsbase/cpsast.ml:8082"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;definition_type&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Static_value</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;value<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Dynamic_value</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;expression<BR></code></div><span style="font-weight:bold">6.</span>&nbsp;
<a id="src/cps/cpsbase/cpsast.ml:8168"></a><code><span style="color: #228b22; ">Enclosing</span></code>s are uplinks from any element (variables,
occurrences, expressions...) to the enclosing expression or
toplevel definition. They are thus not part of the AST stricto
sensu (the AST provides only downlinks from expressions to
elements).</p><p><code><span style="color: #228b22; ">Enclosing_uninitialized</span></code> is a temporary state, encountered only
during CPS expression creation or transformation. 
<BR><a id="src/cps/cpsbase/cpsast.ml:8560"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;enclosing&nbsp;=<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Enclosing_definition</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;definition<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Enclosing_expression</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;expression<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Enclosing_uninitialized</span></p><p><a id="src/cps/cpsbase/cpsast.ml:8687"></a>
<span style="color: #0000ff; font-weight: bold;">end</span>&nbsp;<BR></code></div></p><!--CUT END -->



    <hr />
  </div>
</div>
 
     </div>
          

   
   <script src="/js/jquery.js"></script>
   

   <script src="/dist/js/bootstrap.min.js"></script>

   
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-42249123-1', 'l-lang.org');
     ga('send', 'pageview');
   </script>

   
   <script type="text/javascript">
   $('.my-email').html(function(){
	var d = "t@l-la";
	var e = "ma";
	var a = "t";
	var c = "ng.org";
	var h = 'mailto:' + e + a + d + c;
	$(this).parent('a').attr('href', h);
	return e + a + d + c;
   });
   </script>

  </body>
</html>
