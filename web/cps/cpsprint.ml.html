<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>cpsprint.ml</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<STYLE type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
DIV TABLE{margin-left:inherit;margin-right:inherit;}
PRE{text-align:left;margin-left:0ex;margin-right:auto;}
BLOCKQUOTE{margin-left:4ex;margin-right:4ex;text-align:left;}
TD P{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px;width:auto; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px;width:auto; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
</STYLE>
</HEAD>
<BODY >
<!--HEVEA command line is: /usr/bin/hevea -I /usr/share/texmf/tex/latex/misc ocamlweb.sty cpsprint.ml.tex -->
<!--CUT DEF section 1 --><!--TOC section Module Cpsprint-->
<H2 CLASS="section"><!--SEC ANCHOR -->Module Cpsprint</H2><!--SEC END --><P>
<A NAME="src/cps/cpsprint.ml:0"></A>These functions output a printed representation of a CPS term. One
problem of the CPS representation is that it is difficult to read,
especially because of the deep level of nesting. We tried to
simplify this representation by not showing the nesting explicitely
to the user; instead a parent always has the same level of
indentation than its children in the tree. The syntax looks a lot
like assembly language, or SSA representation.</P><P>Still, this representation could be readily parsed back into a CPS
data structure if needed. 
<BR><A NAME="src/cps/cpsprint.ml:599"></A>
<div style="border: solid 1px gray; background:#eeeeee;
            margin: 0.5em 1em 0.5em 1em;
            padding: 0.5em 1em 0.5em 1em;
            font-family:mono"><code>

<span style="color: #0000ff; font-weight: bold;">open</span> <span style="color: #228b22; ">Format</span></P><P><A NAME="src/cps/cpsprint.ml:613"></A>
<span style="color: #0000ff; font-weight: bold;">open</span> <span style="color: #228b22; ">Cpsbase</span></P><P><A NAME="src/cps/cpsprint.ml:629"></A>
<span style="color: #0000ff; font-weight: bold;">let</span> <span style="color: #0000ff; font-weight: bold;">rec</span> var ppf v = fprintf ppf <span style="color: #8b2252; ">"%s"</span> (<span style="color: #228b22; ">Var.Var.</span>to_string v)<BR>
<span style="color: #0000ff; font-weight: bold;">and</span> occur ppf v = fprintf ppf <span style="color: #8b2252; ">"%s"</span> (<span style="color: #228b22; ">Var.Occur.</span>to_string v)<BR>
<span style="color: #0000ff; font-weight: bold;">and</span> cont_var ppf v = fprintf ppf <span style="color: #8b2252; ">"%s"</span> (<span style="color: #228b22; ">Cont_var.Var.</span>to_string v)<BR>
<span style="color: #0000ff; font-weight: bold;">and</span> cont_occur ppf v = fprintf ppf <span style="color: #8b2252; ">"%s"</span> (<span style="color: #228b22; ">Cont_var.Occur.</span>to_string v)</P><P><A NAME="src/cps/cpsprint.ml:882"></A>
<span style="color: #0000ff; font-weight: bold;">and</span> term ppf t = <span style="color: #a020f0; ">match</span> t.Cpsbase.term <span style="color: #a020f0; ">with</span><BR>  
&#X2223; <span style="color: #228b22; ">Halt</span> v &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"halt %a"</span> occur v<BR>  
&#X2223; <span style="color: #228b22; ">Apply</span>(callerv,k,calleev) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"%a( %a, %a)"</span><BR>        
occur callerv cont_occur k occur calleev<BR>  
&#X2223; <span style="color: #228b22; ">Apply_cont</span>(k,v) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"%a( %a)"</span><BR>        
cont_occur k occur v<BR>  
&#X2223; <span style="color: #228b22; ">Let_cont</span>(k,v,loccont,incont) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"%a where\n%a %a:{\n%a}"</span><BR>        
term incont cont_var k var v term loccont<BR>  
&#X2223; <span style="color: #228b22; ">Let_prim</span>(v,p,body) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"let %a = %a in\n%a"</span><BR>        
var v prim p term body</P><P><A NAME="src/cps/cpsprint.ml:1394"></A>
<span style="color: #0000ff; font-weight: bold;">and</span> prim ppf = <span style="color: #a020f0; ">function</span><BR>  
&#X2223; <span style="color: #228b22; ">Value</span> v &#X2192; value ppf v<BR>  
&#X2223; <span style="color: #228b22; ">Projection</span>(x,i) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"#%d( %a)"</span><BR>        
i occur x<BR>  
&#X2223; <span style="color: #228b22; ">Integer_binary_op</span>(op,v1,v2) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"%s( %a, %a)"</span><BR>        
(<span style="color: #228b22; ">Constant.</span>integer_binary_op_to_string op) occur v1 occur v2</P><P><A NAME="src/cps/cpsprint.ml:1651"></A>
<span style="color: #0000ff; font-weight: bold;">and</span> value ppf = <span style="color: #a020f0; ">function</span><BR>  
&#X2223; <span style="color: #228b22; ">Void</span> &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"void"</span><BR>  
&#X2223; <span style="color: #228b22; ">Constant</span>(c) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"%s"</span> (<span style="color: #228b22; ">Constant.</span>to_string c)<BR>  
&#X2223; <span style="color: #228b22; ">Tuple</span>(l) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"( %a)"</span><BR>        
(<span style="color: #a020f0; ">fun</span> ppf &#X2192; <span style="color: #228b22; ">Utils.</span>print_list_ppf ppf <span style="color: #8b2252; ">", "</span> occur) l<BR>  
&#X2223; <span style="color: #228b22; ">Lambda</span>(k,v,term_) &#X2192;<BR>      
fprintf ppf <span style="color: #8b2252; ">"\n{ %a -&gt; %a -&gt;\n%a}"</span><BR>        
cont_var k var v term term_<BR><BR></code></div></P><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<HR SIZE=2><BLOCKQUOTE CLASS="quote"><EM>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</EM><A HREF="http://hevea.inria.fr/index.html"><EM>H</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>V</EM><EM><FONT SIZE=2><sup>E</sup></FONT></EM><EM>A</EM></A><EM>.</EM></BLOCKQUOTE></BODY>
</HTML>
